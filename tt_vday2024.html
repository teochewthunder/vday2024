<!DOCTYPE html>
<html>
	<head>
		<title>Happy Valentine's Day!</title>

		<style>
			body
			{
				background-color: rgb(255, 255, 255);
			}

			#container
			{
				width: 500px;
				height: 750px;
				margin: 10px auto 0 auto;
			}

			.row
			{
				height: 5px;
				width: 100%;
			}

			.square
			{
				width: 5px;
				height: 5px;
				float: left;
				background-repeat: no-repeat;
				background-size: 500px 750px;
				opacity: 1;
			}

			img
			{
				display: none;
			}
		</style>

		<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

		<script>
			let vday = 
			{
				maxTransitionTime: 20000,
				getRandomImage: function()
				{
					var index = Math.floor(Math.random() * 9);

					return "'img" + index + ".jpg'";
				},
				fillContainer: function()
				{
					var imgUrl = this.getRandomImage();

					for(var i = 0; i < 150; i++) 
					{
						var row = $("<div></div>");
						row.addClass("row");

						for(var j = 0; j < 100; j++) 
						{
							var square = $("<div></div>");
							square.addClass("square");
							square.attr("id", j + "_" + i);
							square.attr("style", "background-image:url(" + imgUrl + ");background-position:-" + (j * 5) + "px -" + (i * 5) + "px");

							row.append(square);
						}

						$("#container").append(row);
					}

					this.transition(this.maxTransitionTime);
				},
				startTransition: function(ms)
				{
					setInterval(
						()=>
						{
							this.transition(ms)
						},
						ms
					);
				},
				transition: function(ms)
				{
					var nextImgUrl = this.getRandomImage();

					var squares = $(".square");

					for(var i = 0; i < squares.length; i++)
					{
						var id = squares[i].id;

						$("#" + id).animate
						(
							{
								opacity: 0
							},
							0.3 * i
						);
					}

					setTimeout(
						()=>
						{
							for(var i = 0; i < squares.length; i++)
							{
								var id = squares[i].id;
								var arrId = id.split("_");
								var x = arrId[0];
								var y = arrId[1];

								$("#" + id).attr("style", "background-image:url(" + nextImgUrl + ");background-position:-" + (x * 5) + "px -" + (y * 5) + "px;opacity:0");

								$("#" + id).animate
								(
									{
										opacity: 1
									},
									(0.3 * i) + i
								);
							}
						},
						ms / 2
					)
				}
			}
		</script>
	</head>

	<body onload="vday.fillContainer();">
		<div id="container">

		</div>

		<img src="img0.jpg" />
		<img src="img1.jpg" />
		<img src="img2.jpg" />
		<img src="img3.jpg" />
		<img src="img4.jpg" />
		<img src="img5.jpg" />
		<img src="img6.jpg" />
		<img src="img7.jpg" />
		<img src="img8.jpg" />
		<img src="img9.jpg" />
	</body>
</html>